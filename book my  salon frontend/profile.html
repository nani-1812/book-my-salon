<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Profile | Book My Salon</title>
    <link rel="stylesheet" href="global.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* profile.html specific styles */
        
        /* The main content area now uses the global dashboard-wrapper and main-content-area styles.
           These specific body/content-area/sidebar layout styles are no longer needed here. */
        /* body {
            display: flex;
            min-height: 100vh;
            flex-direction: column;
        }

        .content-area {
            display: flex;
            flex: 1;
        }

        .sidebar {
            width: 250px;
            background-color: var(--sidebar-bg);
            padding: 1.5rem 1rem;
            box-shadow: var(--shadow-small);
            display: flex;
            flex-direction: column;
            gap: 1rem;
            border-right: 1px solid var(--border-color);
        }

        .sidebar a {
            display: flex;
            align-items: center;
            padding: 0.8rem 1rem;
            color: var(--sidebar-link-color);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: background-color 0.2s ease, color 0.2s ease;
            font-weight: 500;
        }

        .sidebar a.active,
        .sidebar a:hover {
            background-color: var(--primary-color);
            color: var(--button-text);
        }

        .sidebar a i {
            margin-right: 0.75rem;
            font-size: 1.2rem;
        } */

        /* Main content area within the dashboard layout */
        .main-content-area main { /* Targeting the main element specifically within main-content-area */
            flex: 1; /* Main content takes remaining space */
            padding: 3rem 2rem;
            max-width: 800px; /* Adjust max-width for better profile layout */
            margin: 0 auto; /* Center the content within the available main space */
            width: 100%; /* Ensure main content uses full width within its flex context */
        }

        .profile-container {
            background: var(--card-bg);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
            text-align: center;
        }

        .profile-container h1 {
            color: var(--accent-primary);
            margin-bottom: 2rem;
            font-size: 2.5rem;
        }

        .profile-info div {
            display: flex;
            justify-content: center; /* Center content within each div */
            align-items: center;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            color: var(--text-color);
        }

        .profile-info label {
            font-weight: bold;
            margin-right: 0.5rem;
            color: var(--text-primary);
            min-width: 80px; /* Align labels */
            text-align: right;
        }

        /* Styling for the displayed text spans */
        .profile-info span.display-text {
            color: var(--text-secondary);
            text-align: left;
            flex-grow: 1;
            display: block; /* Ensure it takes full width */
        }

        /* Styling for the input fields in edit mode */
        .profile-info input[type="text"],
        .profile-info input[type="email"],
        .profile-info input[type="tel"] {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--input-bg);
            color: var(--text-color);
            flex-grow: 1;
            font-size: 1rem;
            width: auto; /* Override default input width */
        }
        
        /* Buttons for edit and save */
        .profile-actions {
            margin-top: 2rem;
        }

        .btn-edit-profile, .btn-save-profile, .btn-cancel-edit {
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background-color 0.3s ease;
            margin: 0 0.5rem; /* Space between buttons */
        }

        .btn-edit-profile {
            background-color: var(--primary-color);
            color: var(--button-text);
            border: none;
        }
        .btn-edit-profile:hover {
            background-color: var(--primary-color-dark);
        }

        .btn-save-profile {
            background-color: #28a745; /* Green for save */
            color: white;
            border: none;
        }
        .btn-save-profile:hover {
            background-color: #218838;
        }

        .btn-cancel-edit {
            background-color: #6c757d; /* Grey for cancel */
            color: white;
            border: none;
        }
        .btn-cancel-edit:hover {
            background-color: #5a6268;
        }

        /* Hide elements initially in edit mode, show them in display mode */
        .edit-mode .display-text,
        .edit-mode .btn-edit-profile {
            display: none;
        }

        /* Show elements in edit mode, hide them in display mode */
        .display-mode .edit-input,
        .display-mode .btn-save-profile,
        .display-mode .btn-cancel-edit {
            display: none;
        }
    </style>
</head>
<body data-theme="light">
    <div class="dashboard-wrapper">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="frontpage.html" class="logo">Book My Salon</a>
                <button class="toggle-btn" id="toggleBtn" title="Toggle Sidebar">☰</button>
            </div>
            <ul>
                <li data-page="dashboard.html"><a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                <li data-page="salons.html"><a href="salons.html"><i class="fas fa-store"></i> <span>Find Salons</span></a></li>
                <li data-page="appointments.html"><a href="appointments.html"><i class="fas fa-calendar-check"></i> <span>My Appointments</span></a></li>
                <li data-page="profile.html" class="active"><a href="profile.html"><i class="fas fa-user-circle"></i> <span>Profile</span></a></li>
                <li data-page="salon-register.html"><a href="salon-register.html"><i class="fas fa-building"></i> <span>Register Salon</span></a></li>
                <li data-action="logout"><a href="#" id="sidebarLogoutBtn"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a></li>
            </ul>
        </aside>

        <div class="main-content-area" id="mainContentArea">
            <header class="dashboard-header">
                <div class="header-right">
                    <button id="themeToggle" class="theme-toggle" title="Toggle Dark/Light Mode">🌙</button>
                    <button id="logoutBtn" class="btn btn-logout" style="margin-left: 1rem;">Logout</button>
                </div>
            </header>

            <main>
                <div class="profile-container" id="profileContainer">
                    <h1>Update Your Profile</h1>
                    <div class="profile-info">
                        <div>
                            <label>Name:</label>
                            <span id="userNameDisplay" class="display-text">Loading...</span>
                            <input type="text" id="userNameInput" class="edit-input" />
                        </div>
                        <div>
                            <label>Phone:</label>
                            <span id="userPhoneDisplay" class="display-text">+91 XXXXX XXXXX</span>
                            <input type="tel" id="userPhoneInput" class="edit-input" />
                        </div>
                        <div>
                            <label>Email:</label>
                            <span id="userEmailDisplay" class="display-text">user@example.com</span>
                            <input type="email" id="userEmailInput" class="edit-input" />
                        </div>
                    </div>
                    <div class="profile-actions">
                        <button id="editProfileBtn" class="btn-edit-profile">Edit Profile</button>
                        <button id="saveProfileBtn" class="btn-save-profile">Save Changes</button>
                        <button id="cancelEditBtn" class="btn-cancel-edit">Cancel</button>
                    </div>
                </div>
            </main>

            <footer>
                <p>&copy; 2024 Book My Salon. All rights reserved.</p>
            </footer>
        </div>
    </div>

    <script src="theme-switcher.js"></script>
    <script>
        // Define API_BASE_URL (important for actual backend communication)
        // You should replace this with your actual backend URL
        const API_BASE_URL = 'http://localhost:3000'; // Example: Adjust as per your backend setup

        // --- AUTH CHECK: CRITICAL LOGIC ---
        // Function to verify user authentication status
        function checkAuth() {
            const userToken = localStorage.getItem('authToken');
            // If no token, and not already on the frontpage, redirect to frontpage for login.
            if (!userToken) {
                if (window.location.pathname !== '/frontpage.html' && window.location.pathname !== '/') {
                    alert('You must be logged in to view your profile.');
                    window.location.href = 'frontpage.html';
                }
            }
        }
        checkAuth(); // Execute auth check on page load

        // --- UI ELEMENT REFERENCES ---
        // Profile container and display/input elements
        const profileContainer = document.getElementById('profileContainer');
        const userNameDisplay = document.getElementById('userNameDisplay');
        const userPhoneDisplay = document.getElementById('userPhoneDisplay');
        const userEmailDisplay = document.getElementById('userEmailDisplay');

        const userNameInput = document.getElementById('userNameInput');
        const userPhoneInput = document.getElementById('userPhoneInput');
        const userEmailInput = document.getElementById('userEmailInput');

        // Profile action buttons
        const editProfileBtn = document.getElementById('editProfileBtn');
        const saveProfileBtn = document.getElementById('saveProfileBtn');
        const cancelEditBtn = document.getElementById('cancelEditBtn');

        // Dashboard specific elements
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.getElementById('toggleBtn');
        const mainContentArea = document.getElementById('mainContentArea');
        const themeToggle = document.getElementById('themeToggle');
        const logoutBtnHeader = document.getElementById('logoutBtn'); // Logout button in header
        const logoutBtnSidebar = document.getElementById('sidebarLogoutBtn'); // Logout button in sidebar

        // Variables to store original user data for 'Cancel' functionality
        let originalUserName, originalUserPhone, originalUserEmail;

        // --- PROFILE EDIT MODE MANAGEMENT ---
        // Toggles between 'display' (viewing) and 'edit' (editing) modes for profile
        function setMode(mode) {
            if (mode === 'display') {
                profileContainer.classList.add('display-mode');
                profileContainer.classList.remove('edit-mode');
            } else { // mode === 'edit'
                profileContainer.classList.add('edit-mode');
                profileContainer.classList.remove('display-mode');
            }
        }

        // --- USER DATA HANDLING ---
        // Loads user data from localStorage and displays it, also initializes input fields
        function loadUserData() {
            // Retrieve user data from localStorage, providing default placeholders if not found
            userNameDisplay.textContent = localStorage.getItem('userName') || 'Client User';
            userPhoneDisplay.textContent = localStorage.getItem('userPhone') || '+91 98765 43210'; 
            userEmailDisplay.textContent = localStorage.getItem('userEmail') || 'user@example.com'; 

            // Initialize input field values with the currently displayed data
            userNameInput.value = userNameDisplay.textContent;
            userPhoneInput.value = userPhoneDisplay.textContent;
            userEmailInput.value = userEmailDisplay.textContent;

            // Store these initial values as 'original' for the cancel operation
            originalUserName = userNameDisplay.textContent;
            originalUserPhone = userPhoneDisplay.textContent;
            originalUserEmail = userEmailDisplay.textContent;

            setMode('display'); // Ensure the profile is in display mode initially
        }

        // Simulates saving user data to a backend API
        async function saveUserData(userData) {
            const token = localStorage.getItem('authToken');
            if (!token) {
                alert('Authentication token missing. Please log in again.');
                window.location.href = 'frontpage.html';
                return false;
            }

            try {
                // Replace '/api/profile' with your actual backend endpoint for updating user profiles
                const response = await fetch(`${API_BASE_URL}/api/profile`, {
                    method: 'PUT', // Or PATCH, depending on your API design
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(userData)
                });

                if (response.ok) {
                    const result = await response.json();
                    alert(result.message || 'Profile updated successfully!');
                    return true;
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Failed to update profile.');
                }
            } catch (error) {
                console.error('Error updating profile:', error);
                alert(`Error: ${error.message}`);
                return false;
            }
        }


        // --- EVENT LISTENERS ---
        // Edit Profile Button: Switches to edit mode and populates inputs
        editProfileBtn.addEventListener('click', () => {
            // Ensure inputs are populated with current display values before editing
            userNameInput.value = userNameDisplay.textContent;
            userPhoneInput.value = userPhoneDisplay.textContent;
            userEmailInput.value = userEmailDisplay.textContent;
            setMode('edit');
        });

        // Save Changes Button: Collects new data, updates localStorage, and potentially calls API
        saveProfileBtn.addEventListener('click', async () => {
            const newUserName = userNameInput.value;
            const newUserPhone = userPhoneInput.value;
            const newUserEmail = userEmailInput.value;

            // Simple client-side validation (add more robust validation as needed)
            if (!newUserName || !newUserPhone || !newUserEmail) {
                alert('All fields are required!');
                return;
            }

            // Prepare data for API call
            const updatedData = {
                name: newUserName,
                phone: newUserPhone,
                email: newUserEmail
            };

            // Call the simulated API to save data
            const success = await saveUserData(updatedData);

            if (success) {
                // If API call is successful, update localStorage and UI
                localStorage.setItem('userName', newUserName);
                localStorage.setItem('userPhone', newUserPhone);
                localStorage.setItem('userEmail', newUserEmail);

                userNameDisplay.textContent = newUserName;
                userPhoneDisplay.textContent = newUserPhone;
                userEmailDisplay.textContent = newUserEmail;

                loadUserData(); // Reload data to re-establish original values for future edits
                setMode('display');
            }
        });

        // Cancel Button: Reverts changes and switches back to display mode
        cancelEditBtn.addEventListener('click', () => {
            // Revert displayed text to the values stored when loadUserData was last called
            userNameDisplay.textContent = originalUserName;
            userPhoneDisplay.textContent = originalUserPhone;
            userEmailDisplay.textContent = originalUserEmail;
            
            // Also reset input fields to original values in case user re-enters edit mode
            userNameInput.value = originalUserName;
            userPhoneInput.value = originalUserPhone;
            userEmailInput.value = originalUserEmail;

            alert('Edit cancelled. Profile reverted to previous state.');
            setMode('display');
        });

        // --- DASHBOARD LAYOUT & THEME LOGIC ---

        // Function to handle global logout action
        function performLogout() {
            localStorage.removeItem('authToken'); // Clear auth token
            localStorage.removeItem('userName'); // Clear user data
            localStorage.removeItem('userPhone'); 
            localStorage.removeItem('userEmail'); 
            // Add other localStorage keys relevant to user session
            window.location.href = 'frontpage.html'; // Redirect to login/front page
        }

        // Event listeners for logout buttons (header and sidebar)
        logoutBtnHeader.addEventListener('click', performLogout);
        logoutBtnSidebar.addEventListener('click', performLogout);


        // Sidebar toggle logic (desktop)
        if (toggleBtn && sidebar) {
            toggleBtn.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
                document.body.classList.toggle('sidebar-collapsed');
            });
        }

        // Theme toggle logic (from theme-switcher.js, but also handled inline for initial state)
        if (themeToggle) {
            themeToggle.addEventListener('click', () => {
                const currentTheme = document.body.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                document.body.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                themeToggle.textContent = newTheme === 'dark' ? '☀️' : '🌙';
            });
        }
        // Set initial theme based on localStorage
        const storedTheme = localStorage.getItem('theme') || 'light';
        document.body.setAttribute('data-theme', storedTheme);
        if (themeToggle) {
            themeToggle.textContent = storedTheme === 'dark' ? '☀️' : '🌙';
        }

        // Sidebar active state management
        document.addEventListener('DOMContentLoaded', () => {
            const currentPage = 'profile.html'; // This is the profile page
            document.querySelectorAll('.sidebar li').forEach(li => {
                li.classList.remove('active'); // Remove active class from all first
                if (li.getAttribute('data-page') === currentPage) {
                    li.classList.add('active'); // Add active class to the current page's item
                }
            });

            // Mobile Sidebar Toggle Logic
            // This ensures the mobile sidebar functionality is consistent across dashboard pages.
            if (window.innerWidth <= 768) {
                sidebar.classList.add('collapsed'); // Start collapsed on mobile
                sidebar.classList.remove('active'); // Ensure mobile sidebar is hidden by default

                toggleBtn.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent body click from closing immediately
                    sidebar.classList.toggle('active'); // Use 'active' class for mobile sidebar visibility
                    document.body.classList.toggle('sidebar-active'); // To show the overlay
                });

                // Close sidebar when clicking outside (on the overlay)
                document.body.addEventListener('click', (event) => {
                    if (document.body.classList.contains('sidebar-active') &&
                        !sidebar.contains(event.target) &&
                        !toggleBtn.contains(event.target)) {
                        sidebar.classList.remove('active');
                        document.body.classList.remove('sidebar-active');
                    }
                });
            } else {
                // Ensure desktop toggle works if not mobile, and initial state is not 'active' mobile overlay
                document.body.classList.remove('sidebar-active');
                 sidebar.classList.remove('active');
            }
        });
        
        // Load user data when the page loads (after DOM is ready)
        document.addEventListener('DOMContentLoaded', loadUserData);
    </script>
</body>
</html>